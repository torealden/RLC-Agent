<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RLC-Agent File Structure - Tree View</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #161b22 0%, #21262d 100%);
            padding: 15px 25px;
            border-bottom: 1px solid #30363d;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }
        .header h1 {
            font-size: 18px;
            font-weight: 600;
            color: #f0f6fc;
        }
        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .header input {
            background: #0d1117;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            width: 200px;
        }
        .header input:focus {
            outline: none;
            border-color: #58a6ff;
        }
        .header button {
            background: #21262d;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .header button:hover {
            background: #30363d;
            border-color: #8b949e;
        }
        .container {
            display: flex;
            height: 100vh;
            padding-top: 55px;
        }
        #tree-container {
            flex: 1;
            overflow: auto;
            padding: 20px;
        }
        #details-panel {
            width: 350px;
            background: #161b22;
            border-left: 1px solid #30363d;
            padding: 20px;
            overflow-y: auto;
        }
        #details-panel h3 {
            color: #f0f6fc;
            font-size: 14px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #30363d;
        }
        .detail-item {
            margin-bottom: 15px;
        }
        .detail-label {
            font-size: 11px;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .detail-value {
            font-size: 13px;
            color: #c9d1d9;
            line-height: 1.5;
        }
        .detail-value.path {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            color: #58a6ff;
            word-break: break-all;
        }
        .type-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        .new-badge {
            background: #238636;
            color: #fff;
            margin-left: 8px;
        }

        /* Tree styles */
        .node {
            cursor: pointer;
        }
        .node circle {
            stroke-width: 2px;
            transition: all 0.2s;
        }
        .node:hover circle {
            stroke-width: 3px;
            filter: brightness(1.2);
        }
        .node text {
            font-size: 12px;
            fill: #c9d1d9;
        }
        .node text.folder-name {
            font-weight: 600;
        }
        .node.highlighted circle {
            stroke: #f0883e !important;
            stroke-width: 3px;
        }
        .node.highlighted text {
            fill: #f0883e !important;
            font-weight: 600;
        }
        .node.dimmed {
            opacity: 0.25;
        }
        .link {
            fill: none;
            stroke: #30363d;
            stroke-width: 1.5px;
        }
        .link.highlighted {
            stroke: #f0883e;
            stroke-width: 2px;
        }

        /* Legend */
        .legend {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(22, 27, 34, 0.95);
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 12px 15px;
            font-size: 11px;
            z-index: 50;
        }
        .legend-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #f0f6fc;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 4px 0;
        }
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* Stats */
        .stats {
            font-size: 12px;
            color: #8b949e;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>RLC-Agent Project Structure</h1>
            <span class="stats">987 files and folders</span>
        </div>
        <div class="header-controls">
            <input type="text" id="search" placeholder="Search files...">
            <button onclick="expandAll()">Expand All</button>
            <button onclick="collapseAll()">Collapse All</button>
            <button onclick="resetView()">Reset View</button>
        </div>
    </div>

    <div class="container">
        <div id="tree-container">
            <svg id="tree"></svg>
        </div>
        <div id="details-panel">
            <h3>Item Details</h3>
            <div id="details-content">
                <p style="color: #8b949e; font-size: 13px;">Click on any item to view details</p>
            </div>
        </div>
    </div>

    <div class="legend">
        <div class="legend-title">File Types</div>
        <div class="legend-item"><div class="legend-dot" style="background:#f0883e"></div> Folder</div>
        <div class="legend-item"><div class="legend-dot" style="background:#3fb950"></div> Python (.py)</div>
        <div class="legend-item"><div class="legend-dot" style="background:#58a6ff"></div> SQL</div>
        <div class="legend-item"><div class="legend-dot" style="background:#a371f7"></div> Markdown</div>
        <div class="legend-item"><div class="legend-dot" style="background:#f778ba"></div> Data (xlsx/csv)</div>
        <div class="legend-item"><div class="legend-dot" style="background:#79c0ff"></div> Config/JSON</div>
        <div class="legend-item"><div class="legend-dot" style="background:#8b949e"></div> Other</div>
    </div>

    <script>
        // Complete file structure data
        const data = {
            name: "RLC-Agent",
            description: "Root project directory for RLC commodity analytics platform",
            children: [
                {
                    name: "archive",
                    description: "Archived and deprecated code for reference",
                    children: [
                        { name: "deprecated_code", description: "Deprecated scripts and modules", children: [] }
                    ]
                },
                {
                    name: "biotrack",
                    description: "BioTrack AI - Biofuel facility tracking system",
                    children: [
                        { name: "biotrack_ai.py", description: "Main AI agent for biofuel facility monitoring", type: "py" },
                        { name: "README.md", description: "BioTrack module documentation", type: "md" },
                        { name: "requirements.txt", description: "BioTrack-specific dependencies", type: "txt" },
                        {
                            name: "config",
                            description: "BioTrack configuration files",
                            children: [
                                { name: "facilities.csv", description: "Database of biofuel facilities (locations, capacity)", type: "csv" }
                            ]
                        }
                    ]
                },
                {
                    name: "config",
                    description: "Application configuration files",
                    children: [
                        { name: "credentials.env", description: "API credentials and secrets (not in git)", type: "env" },
                        { name: "credentials.example", description: "Template for credentials setup", type: "txt" },
                        { name: "DATA_SOURCES_CHECKLIST.md", description: "Checklist of data sources to implement", type: "md" },
                        { name: "data_sources_master.csv", description: "Master list of all data sources with URLs, frequencies", type: "csv" },
                        { name: "weather_cities.json", description: "Cities for weather data collection", type: "json" },
                        { name: "weather_email_config.json", description: "Weather email agent configuration", type: "json" },
                        { name: "weather_locations.json", description: "Geographic coordinates for weather stations", type: "json" }
                    ]
                },
                {
                    name: "dashboards",
                    description: "PowerBI dashboards and visualization templates",
                    children: [
                        {
                            name: "powerbi",
                            description: "PowerBI dashboard files",
                            children: [
                                { name: "First Sample Dashboard - Ethanol.pbix", description: "Ethanol market dashboard", type: "pbix" },
                                { name: "First Sample Dashboard - RLC.pbix", description: "General RLC commodity dashboard", type: "pbix" },
                                { name: "RLC_Professional_Template_Initial.pbit", description: "Reusable PowerBI template", type: "pbit" },
                                { name: "US Balance Sheets.pbix", description: "US commodity supply/demand balances", type: "pbix" },
                                { name: "us_soybean_trade_flows.pbix", description: "Soybean import/export flow visualization", type: "pbix" },
                                { name: "USDA Prices.pbix", description: "USDA price data dashboard", type: "pbix" }
                            ]
                        },
                        { name: "templates", description: "Dashboard templates", children: [] }
                    ]
                },
                {
                    name: "data",
                    description: "Data storage - raw inputs, processed outputs, exports",
                    children: [
                        { name: "cache", description: "Temporary cache for API responses", children: [] },
                        { name: "cached", description: "Persistent cached data", children: [] },
                        {
                            name: "exports",
                            description: "Exported datasets and analysis",
                            children: [
                                { name: "duplication_analysis.csv", description: "Analysis of duplicate code/data", type: "csv" },
                                { name: "HigbyBarrett_Dashboard.xlsx", description: "HB report data for dashboards", type: "xlsx" },
                                { name: "inventory_agents.csv", description: "Inventory of all agent modules", type: "csv" },
                                { name: "inventory_collectors.csv", description: "Inventory of data collectors", type: "csv" },
                                { name: "inventory_database.csv", description: "Database tables/views inventory", type: "csv" },
                                { name: "inventory_summary.csv", description: "Summary of all inventories", type: "csv" },
                                { name: "proposed_structure.csv", description: "Proposed folder restructuring", type: "csv" }
                            ]
                        },
                        {
                            name: "marketing_years",
                            description: "Marketing year analysis documents",
                            children: [
                                { name: "2012-13_corn_summary.md", description: "2012 drought year corn analysis", type: "md" },
                                { name: "2020-21_corn_summary.md", description: "2020/21 corn marketing year recap", type: "md" },
                                { name: "README.md", description: "Marketing year documentation guide", type: "md" }
                            ]
                        },
                        { name: "processed", description: "Cleaned/transformed data", children: [] },
                        {
                            name: "raw",
                            description: "Raw source data files - USDA, CONAB, EIA, trade statistics (200+ files)",
                            children: [
                                { name: "Acreage Reports (8 files)", description: "USDA planted acreage reports", type: "folder" },
                                { name: "Agricultural Prices (12 files)", description: "Monthly farm price reports", type: "folder" },
                                { name: "Attache Reports (12 files)", description: "USDA FAS international biofuel reports", type: "folder" },
                                { name: "Balance Sheets (15 files)", description: "Supply/demand balance data", type: "folder" },
                                { name: "CONAB (6 files)", description: "Brazilian crop estimates", type: "folder" },
                                { name: "Crop Production (15 files)", description: "USDA monthly crop reports", type: "folder" },
                                { name: "Crop Progress (10 files)", description: "Weekly crop condition reports", type: "folder" },
                                { name: "EIA Data (10 files)", description: "Energy Information Administration data", type: "folder" },
                                { name: "Export Inspections (8 files)", description: "Weekly grain export inspections", type: "folder" },
                                { name: "Fats and Oils (12 files)", description: "NASS fats/oils crushing reports", type: "folder" },
                                { name: "Grain Stocks (8 files)", description: "Quarterly stocks reports", type: "folder" },
                                { name: "Trade Data (40 files)", description: "Census Bureau trade statistics", type: "folder" },
                                { name: "WASDE (20 files)", description: "World supply/demand estimates", type: "folder" }
                            ]
                        },
                        {
                            name: "templates",
                            description: "Data file templates",
                            children: [
                                { name: "marketing_year_template.md", description: "Template for MY analysis docs", type: "md" }
                            ]
                        }
                    ]
                },
                {
                    name: "database",
                    description: "Database schemas, migrations, and queries",
                    children: [
                        { name: "census_trade.db", description: "SQLite database for Census trade data", type: "db" },
                        {
                            name: "migrations",
                            description: "Database migration scripts for schema evolution",
                            children: [
                                { name: "01_inventory_postgres.py", description: "Inventory existing PostgreSQL tables", type: "py" },
                                { name: "02_deploy_medallion_schema.py", description: "Deploy bronze/silver/gold layers", type: "py" },
                                { name: "03_migrate_existing_to_bronze.py", description: "Move legacy data to bronze layer", type: "py" },
                                { name: "04_migrate_sqlite_to_bronze.py", description: "Migrate SQLite data to PostgreSQL", type: "py" },
                                { name: "README.md", description: "Migration process documentation", type: "md" },
                                { name: "run_full_migration.py", description: "Run all migrations in sequence", type: "py" }
                            ]
                        },
                        {
                            name: "queries",
                            description: "Reusable SQL queries",
                            children: [
                                { name: "balance_sheet_inventory.sql", description: "Query to inventory balance sheet data", type: "sql" }
                            ]
                        },
                        {
                            name: "schemas",
                            description: "Medallion architecture schema definitions",
                            children: [
                                { name: "001_schema_foundation.sql", description: "Base schemas (bronze/silver/gold)", type: "sql" },
                                { name: "002_bronze_layer.sql", description: "Bronze (raw) layer tables", type: "sql" },
                                { name: "003_silver_layer.sql", description: "Silver (cleaned) layer tables", type: "sql" },
                                { name: "004_gold_layer.sql", description: "Gold (analytics) layer views", type: "sql" },
                                { name: "005_roles_and_security.sql", description: "Database roles and permissions", type: "sql" },
                                { name: "006_weather_schema.sql", description: "Weather observation tables", type: "sql" },
                                { name: "007_price_schema.sql", description: "Cash and futures price tables", type: "sql" },
                                { name: "008_futures_sessions_schema.sql", description: "Futures session OHLC tables", type: "sql", isNew: true },
                                { name: "010_conab_soybean.sql", description: "CONAB Brazil soybean tables", type: "sql" },
                                { name: "DATABASE_DESIGN.md", description: "Database architecture documentation", type: "md" }
                            ]
                        },
                        {
                            name: "sql",
                            description: "Additional SQL scripts",
                            children: [
                                { name: "00_init.sql", description: "Database initialization", type: "sql" },
                                { name: "002_hb_report_tables.sql", description: "HigbyBarrett report data tables", type: "sql" },
                                { name: "003_comprehensive_commodity_schema.sql", description: "Full commodity data schema", type: "sql" },
                                { name: "04_bronze_wasde.sql", description: "WASDE bronze layer", type: "sql" },
                                { name: "05_silver_observation.sql", description: "Silver observation tables", type: "sql" },
                                { name: "06_gold_views.sql", description: "Gold analytics views", type: "sql" }
                            ]
                        },
                        {
                            name: "views",
                            description: "Database views",
                            children: [
                                { name: "01_traditional_balance_sheets.sql", description: "Balance sheet views v1", type: "sql" },
                                { name: "02_traditional_balance_sheets_v2.sql", description: "Balance sheet views v2", type: "sql" },
                                { name: "03_trade_flow_views.sql", description: "Import/export flow views", type: "sql" },
                                { name: "04_ers_gold_views.sql", description: "ERS data gold layer views", type: "sql" }
                            ]
                        }
                    ]
                },
                {
                    name: "docs",
                    description: "Project documentation (80+ files)",
                    children: [
                        { name: "ARCHITECTURE_PLAN.md", description: "System architecture overview", type: "md" },
                        { name: "AUTOMATED_DATA_PIPELINE.md", description: "Data pipeline documentation", type: "md" },
                        { name: "BALANCE_SHEET_KNOWLEDGE.md", description: "Balance sheet methodology", type: "md" },
                        { name: "CODE_REVIEW.md", description: "Code review guidelines", type: "md" },
                        { name: "CREDENTIALS_REQUIRED.md", description: "Required API credentials list", type: "md" },
                        { name: "DATA_SOURCE_REGISTRY.md", description: "Registry of all data sources", type: "md" },
                        { name: "FILE_INVENTORY_ANNOTATED.md", description: "Complete annotated file listing", type: "md" },
                        { name: "HB_REPORT_AUTOMATION_GUIDE.md", description: "HigbyBarrett report automation", type: "md" },
                        { name: "INTEGRATION_GUIDE.md", description: "System integration guide", type: "md" },
                        { name: "LLM_TRAINING_STRATEGY.md", description: "LLM fine-tuning strategy", type: "md" },
                        { name: "POWER_BI_SETUP_GUIDE.md", description: "PowerBI configuration", type: "md" },
                        { name: "Agents 101.docx", description: "Introduction to agent architecture", type: "docx" },
                        { name: "Complete RLC Master Agent Setup Guide.docx", description: "Full setup instructions", type: "docx" },
                        { name: "Master-Agent Architecture.docx", description: "Architecture iterations", type: "docx" },
                        { name: "RLC Tech Stack.docx", description: "Technology stack overview", type: "docx" },
                        {
                            name: "architecture",
                            description: "Architecture documents",
                            children: [
                                { name: "Folder Structure - The Bible.docx", description: "Definitive folder structure", type: "docx" },
                                { name: "LIBRARY_STRUCTURE.md", description: "Code library organization", type: "md" }
                            ]
                        },
                        {
                            name: "training",
                            description: "Training materials",
                            children: [
                                { name: "CC_TRAINING_GUIDE.md", description: "Claude Code training guide", type: "md" }
                            ]
                        }
                    ]
                },
                {
                    name: "domain_knowledge",
                    description: "Reference materials for LLM context and analyst training",
                    children: [
                        {
                            name: "balance_sheets",
                            description: "Balance sheet templates by commodity category",
                            children: [
                                { name: "biofuels", description: "Ethanol, biodiesel S&D templates", children: [] },
                                { name: "fats_greases", description: "Animal fats, vegetable oils", children: [] },
                                { name: "feed_grains", description: "Corn, sorghum, barley, oats", children: [] },
                                { name: "food_grains", description: "Wheat, rice", children: [] },
                                { name: "oilseeds", description: "Soybeans, canola, sunflower", children: [] }
                            ]
                        },
                        {
                            name: "crop_calendars",
                            description: "Monthly crop activity calendars (12 GIF files)",
                            children: [
                                { name: "January.gif", description: "January planting/harvest calendar", type: "gif" },
                                { name: "February.gif", description: "February calendar", type: "gif" },
                                { name: "March.gif", description: "March calendar", type: "gif" },
                                { name: "April.gif", description: "April calendar", type: "gif" },
                                { name: "May.gif", description: "May calendar", type: "gif" },
                                { name: "June.gif", description: "June calendar", type: "gif" },
                                { name: "July.gif", description: "July calendar", type: "gif" },
                                { name: "August.gif", description: "August calendar", type: "gif" },
                                { name: "September.gif", description: "September calendar", type: "gif" },
                                { name: "October.gif", description: "October calendar", type: "gif" },
                                { name: "November.gif", description: "November calendar", type: "gif" },
                                { name: "December.gif", description: "December calendar", type: "gif" }
                            ]
                        },
                        {
                            name: "crop_maps",
                            description: "Production area maps by region",
                            children: [
                                { name: "argentina", description: "Argentina production maps", children: [] },
                                {
                                    name: "brazil",
                                    description: "Brazil production maps",
                                    children: [
                                        { name: "Brazil - Soybean - 2023.png", description: "Brazil soybean production areas", type: "png" }
                                    ]
                                },
                                {
                                    name: "us",
                                    description: "US production maps (17 PNGs)",
                                    children: [
                                        { name: "US - Corn - 2023.png", description: "US corn production areas", type: "png" },
                                        { name: "US - Soybean - 2023.png", description: "US soybean production areas", type: "png" },
                                        { name: "US - Wheat - 2023.png", description: "US wheat production areas", type: "png" },
                                        { name: "US - Cotton - 2023.png", description: "US cotton production areas", type: "png" },
                                        { name: "US - Sorghum - 2023.png", description: "US sorghum production areas", type: "png" }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "operator_guides",
                            description: "Operational procedures for different agent roles",
                            children: [
                                { name: "App Developer Operator.docx", description: "App development procedures", type: "docx" },
                                { name: "Checker Operator.docx", description: "Quality check procedures", type: "docx" },
                                { name: "Data Gathering Operator.docx", description: "Data collection procedures", type: "docx" },
                                { name: "Pattern Analysis Operator.docx", description: "Pattern analysis procedures", type: "docx" },
                                { name: "Project Manager Operator.docx", description: "PM procedures", type: "docx" },
                                { name: "Trading Code Operator.docx", description: "Trading algorithm procedures", type: "docx" }
                            ]
                        },
                        {
                            name: "sample_presentations",
                            description: "Historical presentation files",
                            children: [
                                { name: "AFOA Conference Presentation.pptx", description: "AFOA 2021 presentation", type: "pptx" },
                                { name: "Biomass Based Diesel Outlook.pptx", description: "BBD outlook", type: "pptx" },
                                { name: "Feed Grains Presentation.pptx", description: "Feed grains overview", type: "pptx" },
                                { name: "Master Presentation.pptx", description: "Master template", type: "pptx" }
                            ]
                        },
                        {
                            name: "sample_reports",
                            description: "Sample industry reports for training",
                            children: [
                                { name: "HigbyBarrett Weekly Report samples (6)", description: "HB weekly report samples", type: "docx" },
                                {
                                    name: "data",
                                    description: "Report source data",
                                    children: [
                                        { name: "cross_commodity (11 files)", description: "Multi-commodity reports", type: "folder" },
                                        { name: "feed_grains (4 files)", description: "Feed grain data", type: "folder" },
                                        { name: "food_grains (15 CSVs)", description: "Wheat yearbook tables", type: "folder" },
                                        { name: "livestock (11 files)", description: "Cattle on feed data", type: "folder" }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "special_situations",
                            description: "Analysis of historical market-moving events",
                            children: [
                                { name: "2012_us_drought.md", description: "2012 US drought impact analysis", type: "md" },
                                { name: "2018_china_trade_war.md", description: "China trade war market impact", type: "md" },
                                { name: "2020_china_demand_surge.md", description: "2020 China buying surge", type: "md" },
                                { name: "2020_derecho.md", description: "August 2020 derecho damage", type: "md" },
                                { name: "2022_ukraine_war.md", description: "Ukraine war grain impact", type: "md" },
                                { name: "README.md", description: "Special situations guide", type: "md" }
                            ]
                        }
                    ]
                },
                {
                    name: "output",
                    description: "Generated outputs - logs, reports, visualizations",
                    children: [
                        {
                            name: "logs",
                            description: "System and process logs",
                            children: [
                                { name: "data_checker.log", description: "Data validation agent log", type: "log" },
                                { name: "hb_report_v2.log", description: "HB report V2 generation logs", type: "log" },
                                { name: "overnight_runner_20260127.log", description: "Overnight daemon log", type: "log", isNew: true },
                                { name: "weather_collector.log", description: "Weather collection log", type: "log" }
                            ]
                        },
                        {
                            name: "reports",
                            description: "Generated market reports",
                            children: [
                                { name: "brazil_crop_update", description: "Brazil crop updates", children: [] },
                                {
                                    name: "higby_barrett",
                                    description: "HigbyBarrett weekly reports",
                                    children: [
                                        { name: "HB_Weekly_DATA_V2.json", description: "Report source data JSON", type: "json" },
                                        { name: "HB_Weekly_PROMPT_V2.txt", description: "LLM prompts used", type: "txt" },
                                        { name: "HB_Weekly_Report_V2.md", description: "Generated report markdown", type: "md" }
                                    ]
                                },
                                {
                                    name: "weather_summaries",
                                    description: "Weather summary reports (12 files)",
                                    children: [
                                        { name: "weather_summary_*.txt", description: "Daily weather summaries", type: "txt" }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "visualizations",
                            description: "Generated charts and graphs",
                            children: [
                                { name: "corn_balance_sheet.png", description: "Corn S&D chart", type: "png" },
                                { name: "corn_prices.png", description: "Corn price chart", type: "png" },
                                { name: "soybean_balance_sheet.png", description: "Soybean S&D chart", type: "png" },
                                { name: "soybean_crush_margin.png", description: "Crush margin chart", type: "png" },
                                { name: "wheat_balance_sheet.png", description: "Wheat S&D chart", type: "png" },
                                { name: "wheat_export_destinations.png", description: "Wheat export flows", type: "png" },
                                { name: "file_tree.html", description: "This visualization", type: "html" },
                                { name: "file_treemap.html", description: "Treemap visualization", type: "html" }
                            ]
                        }
                    ]
                },
                {
                    name: "scripts",
                    description: "Utility scripts for data collection, transformation, and analysis",
                    children: [
                        { name: "collect.py", description: "General data collection runner", type: "py" },
                        { name: "create_powerbi_export.py", description: "Export data for PowerBI", type: "py" },
                        { name: "data_scheduler.py", description: "Data collection scheduler", type: "py" },
                        { name: "ingest_wasde.py", description: "WASDE report ingestion", type: "py" },
                        { name: "ingest_wheat_data.py", description: "Wheat data ingestion", type: "py" },
                        { name: "llm_assistant.py", description: "LLM assistant interface", type: "py" },
                        { name: "overnight_runner.py", description: "Overnight scheduler daemon", type: "py", isNew: true },
                        { name: "pull_census_trade.py", description: "Census trade data pull", type: "py" },
                        { name: "pull_weekly_inspections.py", description: "Weekly export inspections", type: "py" },
                        { name: "test_hb_report_generation_v2.py", description: "HB report test V2 (enhanced)", type: "py" },
                        {
                            name: "collectors",
                            description: "Standalone collector scripts",
                            children: [
                                { name: "__init__.py", description: "Package init", type: "py" },
                                { name: "ers_feed_grains_collector.py", description: "ERS feed grains collector", type: "py" },
                                { name: "ers_monthly_outlook_collector.py", description: "ERS outlook collector", type: "py" }
                            ]
                        },
                        {
                            name: "deployment",
                            description: "Deployment and setup scripts",
                            children: [
                                { name: "agent_tools.py", description: "Agent utility functions", type: "py" },
                                { name: "balance_sheet_extractor.py", description: "Balance sheet data extraction", type: "py" },
                                { name: "db_config.py", description: "Database configuration", type: "py" },
                                { name: "deploy_to_rlc_server.py", description: "Server deployment script", type: "py" },
                                { name: "document_rag.py", description: "Document RAG system", type: "py" },
                                { name: "forecast_tracker.py", description: "Forecast accuracy tracker", type: "py" },
                                { name: "powerbi_export.py", description: "PowerBI data export", type: "py" },
                                { name: "setup_rlc_server.ps1", description: "PowerShell server setup", type: "ps1" }
                            ]
                        },
                        {
                            name: "transformations",
                            description: "Data transformation (bronze -> silver -> gold)",
                            children: [
                                { name: "__init__.py", description: "Package init", type: "py" },
                                { name: "oilseed_silver_transformations.py", description: "Oilseed data transforms", type: "py" },
                                { name: "silver_transformations.py", description: "General silver transforms", type: "py" },
                                { name: "wheat_silver_transformations.py", description: "Wheat data transforms", type: "py" }
                            ]
                        },
                        {
                            name: "visualizations",
                            description: "Chart generation scripts",
                            children: [
                                { name: "__init__.py", description: "Package init", type: "py" },
                                { name: "gold_visualizations.py", description: "Gold layer visualizations", type: "py" },
                                { name: "oilseed_visualizations.py", description: "Oilseed charts", type: "py" },
                                { name: "wheat_visualizations.py", description: "Wheat charts", type: "py" }
                            ]
                        }
                    ]
                },
                {
                    name: "src",
                    description: "Main source code - agents, services, orchestrators",
                    children: [
                        { name: "__init__.py", description: "Package init", type: "py" },
                        { name: "main.py", description: "Application entry point", type: "py" },
                        {
                            name: "agents",
                            description: "AI agents for data collection, analysis, and reporting",
                            children: [
                                { name: "__init__.py", description: "Package init", type: "py" },
                                {
                                    name: "analysis",
                                    description: "Market analysis agents",
                                    children: [
                                        { name: "__init__.py", description: "Package init", type: "py" },
                                        { name: "fundamental_analyzer.py", description: "Fundamental S&D analysis", type: "py" },
                                        { name: "price_forecaster.py", description: "Price prediction agent", type: "py" },
                                        { name: "spread_and_basis_analyzer.py", description: "Spread/basis analysis", type: "py" }
                                    ]
                                },
                                {
                                    name: "base",
                                    description: "Base classes for all agents",
                                    children: [
                                        { name: "__init__.py", description: "Package init", type: "py" },
                                        { name: "base_collector.py", description: "Base data collector class", type: "py" },
                                        { name: "base_lineup_agent.py", description: "Base vessel lineup agent", type: "py" },
                                        { name: "base_trade_agent.py", description: "Base trade data agent", type: "py" }
                                    ]
                                },
                                {
                                    name: "collectors",
                                    description: "Data collection agents by region/source",
                                    children: [
                                        { name: "__init__.py", description: "Package init", type: "py" },
                                        {
                                            name: "asia",
                                            description: "Asian data collectors",
                                            children: [
                                                { name: "__init__.py", description: "Package init", type: "py" },
                                                { name: "mpob_collector.py", description: "Malaysia Palm Oil Board data", type: "py" }
                                            ]
                                        },
                                        {
                                            name: "canada",
                                            description: "Canadian data collectors",
                                            children: [
                                                { name: "__init__.py", description: "Package init", type: "py" },
                                                { name: "canada_cgc_collector.py", description: "Canadian Grain Commission data", type: "py" },
                                                { name: "canada_statscan_collector.py", description: "Statistics Canada data", type: "py" }
                                            ]
                                        },
                                        {
                                            name: "europe",
                                            description: "European data collectors",
                                            children: [
                                                { name: "__init__.py", description: "Package init", type: "py" }
                                            ]
                                        },
                                        {
                                            name: "global",
                                            description: "Global data collectors",
                                            children: [
                                                { name: "__init__.py", description: "Package init", type: "py" },
                                                { name: "faostat_collector.py", description: "FAO statistics collector", type: "py" }
                                            ]
                                        },
                                        {
                                            name: "market",
                                            description: "Market data collectors (prices, futures)",
                                            children: [
                                                { name: "__init__.py", description: "Package init", type: "py" },
                                                { name: "cme_settlements_collector.py", description: "CME settlement prices", type: "py" },
                                                { name: "futures_data_collector.py", description: "General futures data", type: "py" },
                                                { name: "ibkr_collector.py", description: "Interactive Brokers data", type: "py" },
                                                { name: "tradestation_collector.py", description: "TradeStation data", type: "py" },
                                                { name: "yahoo_futures_collector.py", description: "Yahoo Finance futures with session capture", type: "py", isNew: true }
                                            ]
                                        },
                                        {
                                            name: "south_america",
                                            description: "South American data collectors",
                                            children: [
                                                { name: "__init__.py", description: "Package init", type: "py" },
                                                { name: "abiove_collector.py", description: "Brazil Veg Oil Association data", type: "py" },
                                                { name: "argentina_agent.py", description: "Argentina trade data", type: "py" },
                                                { name: "base_collector.py", description: "Base collector for SA", type: "py", isNew: true },
                                                { name: "brazil_agent.py", description: "Brazil Comex Stat trade data", type: "py" },
                                                { name: "brazil_lineup_agent.py", description: "Brazil vessel lineup", type: "py" },
                                                { name: "conab_collector.py", description: "CONAB Brazil crop estimates", type: "py", isNew: true },
                                                { name: "conab_soybean_agent.py", description: "CONAB soybean specialist", type: "py" },
                                                { name: "ibge_sidra_collector.py", description: "Brazil IBGE statistics", type: "py" },
                                                { name: "imea_collector.py", description: "Mato Grosso economics institute", type: "py" },
                                                { name: "magyp_collector.py", description: "Argentina agriculture ministry", type: "py" }
                                            ]
                                        },
                                        {
                                            name: "tenders",
                                            description: "Tender monitoring agents",
                                            children: [
                                                { name: "__init__.py", description: "Package init", type: "py" },
                                                { name: "alert_system.py", description: "Tender alert notifications", type: "py" },
                                                { name: "wheat_tender_collector.py", description: "International wheat tenders", type: "py" }
                                            ]
                                        },
                                        {
                                            name: "us",
                                            description: "US government data collectors",
                                            children: [
                                                { name: "__init__.py", description: "Package init", type: "py" },
                                                { name: "base_collector.py", description: "Base US collector", type: "py" },
                                                { name: "census_trade_collector.py", description: "Census Bureau trade data", type: "py" },
                                                { name: "cftc_cot_collector.py", description: "CFTC Commitments of Traders", type: "py" },
                                                { name: "drought_collector.py", description: "US Drought Monitor data", type: "py" },
                                                { name: "eia_ethanol_collector.py", description: "EIA ethanol production", type: "py" },
                                                { name: "eia_petroleum_collector.py", description: "EIA petroleum data", type: "py" },
                                                { name: "epa_rfs_collector.py", description: "EPA Renewable Fuel Standard", type: "py" },
                                                { name: "usda_ams_collector.py", description: "USDA AMS market news", type: "py" },
                                                { name: "usda_ers_collector.py", description: "USDA ERS outlook data", type: "py" },
                                                { name: "usda_fas_collector.py", description: "USDA FAS export sales", type: "py" },
                                                { name: "usda_nass_collector.py", description: "USDA NASS crop data", type: "py" }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    name: "core",
                                    description: "Core agent infrastructure",
                                    children: [
                                        { name: "__init__.py", description: "Package init", type: "py" },
                                        { name: "approval_manager.py", description: "Human approval workflow", type: "py" },
                                        { name: "data_agent.py", description: "Data handling agent", type: "py" },
                                        { name: "database_agent.py", description: "Database operations agent", type: "py" },
                                        { name: "master_agent.py", description: "Master orchestration agent", type: "py" },
                                        { name: "memory_manager.py", description: "Agent memory/context manager", type: "py" },
                                        { name: "transformation_logger.py", description: "ETL audit logger", type: "py" },
                                        { name: "verification_agent.py", description: "Data verification agent", type: "py" }
                                    ]
                                },
                                {
                                    name: "integration",
                                    description: "External system integrations",
                                    children: [
                                        { name: "__init__.py", description: "Package init", type: "py" },
                                        { name: "calendar_agent.py", description: "Google Calendar integration", type: "py" },
                                        { name: "email_agent.py", description: "Email processing agent", type: "py" },
                                        { name: "ibkr_api_connector.py", description: "IBKR API connection", type: "py" },
                                        { name: "notion_manager.py", description: "Notion workspace integration", type: "py" }
                                    ]
                                },
                                {
                                    name: "reporting",
                                    description: "Report generation agents",
                                    children: [
                                        { name: "__init__.py", description: "Package init", type: "py" },
                                        { name: "internal_data_agent.py", description: "Internal data reports", type: "py" },
                                        { name: "market_research_agent.py", description: "Market research agent", type: "py" },
                                        { name: "price_data_agent.py", description: "Price data reports", type: "py" },
                                        { name: "report_writer_agent.py", description: "Report generation agent", type: "py" }
                                    ]
                                },
                                {
                                    name: "standalone",
                                    description: "Standalone agent runner system",
                                    children: [
                                        { name: "__init__.py", description: "Package init", type: "py" },
                                        { name: "agent.py", description: "Standalone agent class", type: "py" },
                                        { name: "config.py", description: "Standalone configuration", type: "py" },
                                        { name: "run_daemon.bat", description: "Windows daemon runner", type: "bat" },
                                        { name: "start_agent.bat", description: "Windows agent starter", type: "bat" },
                                        { name: "submit_task.py", description: "Task submission script", type: "py" },
                                        { name: "tools.py", description: "Standalone agent tools", type: "py" }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "orchestrators",
                            description: "Pipeline orchestration for multi-step workflows",
                            children: [
                                { name: "__init__.py", description: "Package init", type: "py" },
                                { name: "conab_soybean_orchestrator.py", description: "CONAB soybean data pipeline", type: "py" },
                                { name: "hb_report_orchestrator.py", description: "HB report generation pipeline", type: "py" },
                                { name: "pipeline_orchestrator.py", description: "General pipeline orchestrator", type: "py" },
                                { name: "trade_data_orchestrator.py", description: "Trade data pipeline", type: "py" }
                            ]
                        },
                        {
                            name: "scheduler",
                            description: "Task scheduling and automation",
                            children: [
                                { name: "__init__.py", description: "Package init", type: "py" },
                                { name: "agent_scheduler.py", description: "Agent execution scheduler", type: "py" },
                                { name: "daily_activity_log.py", description: "Daily activity logging", type: "py" },
                                { name: "master_scheduler.py", description: "Master schedule with futures + CONAB", type: "py", isNew: true },
                                { name: "README.md", description: "Scheduler documentation", type: "md" },
                                { name: "report_scheduler.py", description: "Report generation scheduler", type: "py" },
                                { name: "trade_scheduler.py", description: "Trade data scheduler", type: "py" },
                                {
                                    name: "agents",
                                    description: "Scheduler-specific agents",
                                    children: [
                                        { name: "cash_price_collector_agent.py", description: "Cash price collection", type: "py" },
                                        { name: "data_checker_agent.py", description: "Data validation agent", type: "py" },
                                        { name: "weather_collector_agent.py", description: "Weather data collection", type: "py" },
                                        { name: "weather_email_agent.py", description: "Weather email processing", type: "py" }
                                    ]
                                },
                                {
                                    name: "tasks",
                                    description: "Windows Task Scheduler scripts",
                                    children: [
                                        { name: "README.md", description: "Task documentation", type: "md" },
                                        { name: "run_agent_scheduler.bat", description: "Run agent scheduler", type: "bat" },
                                        { name: "run_data_checker.bat", description: "Run data checker", type: "bat" },
                                        { name: "run_weather_collector.bat", description: "Run weather collector", type: "bat" },
                                        { name: "setup_windows_tasks.ps1", description: "PowerShell task setup", type: "ps1" }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "services",
                            description: "Shared service modules",
                            children: [
                                { name: "__init__.py", description: "Package init", type: "py" },
                                { name: "city_enrollment_service.py", description: "City/location enrollment", type: "py" },
                                { name: "location_service.py", description: "Geographic location service", type: "py" },
                                {
                                    name: "api",
                                    description: "API client services",
                                    children: [
                                        { name: "__init__.py", description: "Package init", type: "py" },
                                        { name: "census_api.py", description: "Census Bureau API client", type: "py" },
                                        { name: "usda_api.py", description: "USDA API client", type: "py" },
                                        { name: "weather_api.py", description: "OpenWeather API client", type: "py" },
                                        { name: "world_weather_service.py", description: "World weather service", type: "py" }
                                    ]
                                },
                                {
                                    name: "database",
                                    description: "Database services",
                                    children: [
                                        { name: "__init__.py", description: "Package init", type: "py" },
                                        { name: "data_loader.py", description: "Data loading utilities", type: "py" },
                                        { name: "db_config.py", description: "Database configuration", type: "py" },
                                        { name: "schema.py", description: "Schema definitions", type: "py" }
                                    ]
                                },
                                {
                                    name: "document",
                                    description: "Document processing services",
                                    children: [
                                        { name: "__init__.py", description: "Package init", type: "py" },
                                        { name: "document_builder.py", description: "Document generation", type: "py" },
                                        { name: "document_rag.py", description: "Document RAG system", type: "py" }
                                    ]
                                }
                            ]
                        },
                        {
                            name: "tools",
                            description: "Shared agent tools",
                            children: [
                                { name: "__init__.py", description: "Package init", type: "py" },
                                { name: "agent_tools.py", description: "Common agent utilities", type: "py" }
                            ]
                        },
                        {
                            name: "utils",
                            description: "Utility functions",
                            children: [
                                { name: "__init__.py", description: "Package init", type: "py" },
                                { name: "config.py", description: "Configuration utilities", type: "py" }
                            ]
                        }
                    ]
                },
                {
                    name: "tests",
                    description: "Test files and fixtures",
                    children: [
                        { name: "test_conab_soybean_pipeline.py", description: "CONAB pipeline tests", type: "py" },
                        { name: "test_wheat_tender_collector.py", description: "Wheat tender tests", type: "py" },
                        {
                            name: "collectors",
                            description: "Collector test fixtures",
                            children: [
                                { name: "test_sample_food_sales.csv", description: "Test data file", type: "csv" }
                            ]
                        }
                    ]
                },
                {
                    name: "training",
                    description: "LLM training materials",
                    children: [
                        { name: "CC_TRAINING_GUIDE.md", description: "Claude Code training guide", type: "md" },
                        {
                            name: "process_docs",
                            description: "Process documentation",
                            children: [
                                { name: "TEMPLATE_process.md", description: "Process document template", type: "md" }
                            ]
                        }
                    ]
                },
                // Root files
                { name: ".env", description: "Environment variables (DB credentials, API keys)", type: "env" },
                { name: ".env.example", description: "Template for environment variables", type: "txt" },
                { name: ".gitignore", description: "Git ignore patterns", type: "txt" },
                { name: ".mcp.json", description: "Model Context Protocol config for Claude Code", type: "json" },
                { name: "LLM_SETUP_PLAN.md", description: "Planning document for local LLM integration", type: "md" },
                { name: "README.md", description: "Project overview and setup instructions", type: "md" },
                { name: "requirements.txt", description: "Python package dependencies", type: "txt" },
                { name: "start_overnight_test.py", description: "Launch overnight data collection tests", type: "py" }
            ]
        };

        // Color by file type
        const typeColors = {
            'py': '#3fb950',
            'sql': '#58a6ff',
            'md': '#a371f7',
            'xlsx': '#f778ba',
            'csv': '#f778ba',
            'xls': '#f778ba',
            'docx': '#8b949e',
            'doc': '#8b949e',
            'pdf': '#8b949e',
            'pptx': '#8b949e',
            'json': '#79c0ff',
            'env': '#79c0ff',
            'txt': '#8b949e',
            'bat': '#79c0ff',
            'ps1': '#79c0ff',
            'sh': '#79c0ff',
            'png': '#fdcb6e',
            'gif': '#fdcb6e',
            'jpg': '#fdcb6e',
            'pbix': '#f39c12',
            'pbit': '#f39c12',
            'db': '#e17055',
            'log': '#636e72',
            'html': '#e84393',
            'folder': '#f0883e'
        };

        // Setup SVG
        const container = document.getElementById('tree-container');
        const svg = d3.select('#tree');
        const g = svg.append('g');

        // Tree layout settings
        const nodeWidth = 220;
        const nodeHeight = 25;
        let i = 0;
        let root;

        // Create hierarchy
        root = d3.hierarchy(data);
        root.x0 = 0;
        root.y0 = 0;

        // Collapse all children initially except first level
        root.children.forEach(collapse);

        function collapse(d) {
            if (d.children) {
                d._children = d.children;
                d._children.forEach(collapse);
                d.children = null;
            }
        }

        function expand(d) {
            if (d._children) {
                d.children = d._children;
                d._children = null;
            }
        }

        // Get node color
        function getNodeColor(d) {
            if (d.data.isNew) return '#238636';
            if (d.children || d._children) return typeColors.folder;
            const ext = d.data.type || (d.data.name.includes('.') ? d.data.name.split('.').pop().toLowerCase() : 'folder');
            return typeColors[ext] || '#8b949e';
        }

        // Update tree
        function update(source) {
            // Tree layout
            const treeLayout = d3.tree().nodeSize([nodeHeight, nodeWidth]);
            const treeData = treeLayout(root);

            // Get nodes and links
            const nodes = treeData.descendants();
            const links = treeData.links();

            // Normalize depth
            nodes.forEach(d => {
                d.y = d.depth * 200;
            });

            // Calculate bounds
            let minX = Infinity, maxX = -Infinity, minY = 0, maxY = 0;
            nodes.forEach(d => {
                if (d.x < minX) minX = d.x;
                if (d.x > maxX) maxX = d.x;
                if (d.y > maxY) maxY = d.y;
            });

            // Update SVG size
            const width = maxY + 400;
            const height = maxX - minX + 100;
            svg.attr('width', width).attr('height', height);
            g.attr('transform', `translate(50, ${-minX + 50})`);

            // Nodes
            const node = g.selectAll('g.node')
                .data(nodes, d => d.id || (d.id = ++i));

            // Enter nodes
            const nodeEnter = node.enter().append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${source.y0 || 0},${source.x0 || 0})`)
                .on('click', (event, d) => {
                    if (d.children) {
                        d._children = d.children;
                        d.children = null;
                    } else if (d._children) {
                        d.children = d._children;
                        d._children = null;
                    }
                    update(d);
                    showDetails(d);
                });

            // Node circles
            nodeEnter.append('circle')
                .attr('r', 6)
                .attr('fill', d => d.children || d._children ? '#0d1117' : getNodeColor(d))
                .attr('stroke', d => getNodeColor(d))
                .attr('stroke-width', 2);

            // Node labels
            nodeEnter.append('text')
                .attr('dy', '.35em')
                .attr('x', d => 12)
                .attr('class', d => d.children || d._children ? 'folder-name' : '')
                .text(d => {
                    const name = d.data.name;
                    return name.length > 35 ? name.slice(0, 32) + '...' : name;
                });

            // Expand/collapse indicator
            nodeEnter.append('text')
                .attr('class', 'toggle-indicator')
                .attr('dy', '.35em')
                .attr('x', -12)
                .attr('text-anchor', 'middle')
                .attr('fill', '#8b949e')
                .attr('font-size', '10px')
                .text(d => d._children ? '+' : (d.children ? '-' : ''));

            // Update nodes
            const nodeUpdate = nodeEnter.merge(node);

            nodeUpdate.transition()
                .duration(300)
                .attr('transform', d => `translate(${d.y},${d.x})`);

            nodeUpdate.select('circle')
                .attr('fill', d => d.children || d._children ? '#0d1117' : getNodeColor(d))
                .attr('stroke', d => getNodeColor(d));

            nodeUpdate.select('.toggle-indicator')
                .text(d => d._children ? '+' : (d.children ? '-' : ''));

            // Exit nodes
            const nodeExit = node.exit().transition()
                .duration(300)
                .attr('transform', d => `translate(${source.y},${source.x})`)
                .remove();

            // Links
            const link = g.selectAll('path.link')
                .data(links, d => d.target.id);

            // Enter links
            const linkEnter = link.enter().insert('path', 'g')
                .attr('class', 'link')
                .attr('d', d => {
                    const o = { x: source.x0 || 0, y: source.y0 || 0 };
                    return diagonal(o, o);
                });

            // Update links
            const linkUpdate = linkEnter.merge(link);

            linkUpdate.transition()
                .duration(300)
                .attr('d', d => diagonal(d.source, d.target));

            // Exit links
            link.exit().transition()
                .duration(300)
                .attr('d', d => {
                    const o = { x: source.x, y: source.y };
                    return diagonal(o, o);
                })
                .remove();

            // Store old positions
            nodes.forEach(d => {
                d.x0 = d.x;
                d.y0 = d.y;
            });
        }

        // Diagonal path generator
        function diagonal(s, d) {
            return `M ${s.y} ${s.x}
                    C ${(s.y + d.y) / 2} ${s.x},
                      ${(s.y + d.y) / 2} ${d.x},
                      ${d.y} ${d.x}`;
        }

        // Show details panel
        function showDetails(d) {
            const isFolder = d.children || d._children;
            const ext = d.data.type || (d.data.name.includes('.') ? d.data.name.split('.').pop().toUpperCase() : 'Folder');
            const color = getNodeColor(d);

            // Build path
            const path = d.ancestors().reverse().map(n => n.data.name).join('/');

            let html = `
                <div class="detail-item">
                    <div class="detail-label">Name</div>
                    <div class="detail-value">${d.data.name}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Path</div>
                    <div class="detail-value path">${path}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value">
                        <span class="type-badge" style="background:${color};color:${isFolder ? '#fff' : '#000'}">${isFolder ? 'Folder' : ext.toUpperCase()}</span>
                        ${d.data.isNew ? '<span class="type-badge new-badge">NEW/MODIFIED</span>' : ''}
                    </div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Description</div>
                    <div class="detail-value">${d.data.description || 'No description available'}</div>
                </div>
            `;

            if (isFolder) {
                const childCount = (d.children || d._children || []).length;
                html += `
                    <div class="detail-item">
                        <div class="detail-label">Contents</div>
                        <div class="detail-value">${childCount} item${childCount !== 1 ? 's' : ''}</div>
                    </div>
                `;
            }

            document.getElementById('details-content').innerHTML = html;
        }

        // Expand all
        function expandAll() {
            root.descendants().forEach(d => {
                if (d._children) {
                    d.children = d._children;
                    d._children = null;
                }
            });
            update(root);
        }

        // Collapse all
        function collapseAll() {
            root.descendants().forEach(d => {
                if (d.children && d.depth > 0) {
                    d._children = d.children;
                    d.children = null;
                }
            });
            update(root);
        }

        // Reset view
        function resetView() {
            root.descendants().forEach(d => {
                if (d.depth === 0) {
                    if (d._children) {
                        d.children = d._children;
                        d._children = null;
                    }
                } else if (d.depth === 1) {
                    if (d.children) {
                        d._children = d.children;
                        d.children = null;
                    }
                }
            });
            update(root);
            container.scrollTo(0, 0);
        }

        // Search functionality
        let searchTimeout;
        document.getElementById('search').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.toLowerCase().trim();

            searchTimeout = setTimeout(() => {
                // Reset highlights
                g.selectAll('.node').classed('highlighted', false).classed('dimmed', false);
                g.selectAll('.link').classed('highlighted', false);

                if (!query) return;

                // Find matching nodes
                const matches = [];
                root.descendants().forEach(d => {
                    const name = d.data.name.toLowerCase();
                    const desc = (d.data.description || '').toLowerCase();
                    if (name.includes(query) || desc.includes(query)) {
                        matches.push(d);
                    }
                });

                if (matches.length === 0) return;

                // Expand paths to matches
                matches.forEach(match => {
                    let current = match.parent;
                    while (current) {
                        if (current._children) {
                            current.children = current._children;
                            current._children = null;
                        }
                        current = current.parent;
                    }
                });

                update(root);

                // Highlight matches
                setTimeout(() => {
                    const matchIds = new Set(matches.map(m => m.id));
                    g.selectAll('.node')
                        .classed('highlighted', d => matchIds.has(d.id))
                        .classed('dimmed', d => !matchIds.has(d.id));

                    // Scroll to first match
                    if (matches.length > 0) {
                        const firstMatch = matches[0];
                        container.scrollTo({
                            left: firstMatch.y - 100,
                            top: firstMatch.x - container.clientHeight / 2 + 50,
                            behavior: 'smooth'
                        });
                    }
                }, 350);
            }, 300);
        });

        // Initial render
        update(root);
    </script>
</body>
</html>
