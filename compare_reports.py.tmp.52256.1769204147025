#!/usr/bin/env python3
"""Compare Iowa vs Kansas report structures"""

import os
import json
import requests
from dotenv import load_dotenv
from pathlib import Path

load_dotenv(Path(__file__).parent / ".env")

USDA_API_KEY = os.getenv('USDA_AMS_API_KEY', '')
USDA_BASE_URL = 'https://marsapi.ams.usda.gov/services/v1.2'

session = requests.Session()
session.auth = (USDA_API_KEY, '')
session.headers.update({'Accept': 'application/json'})

reports = [
    ('2850', 'Iowa'),
    ('2886', 'Kansas'),
    ('3192', 'Illinois')
]

for slug_id, name in reports:
    print(f"\n{'='*60}")
    print(f"=== {name} ({slug_id}) ===")
    print(f"{'='*60}")

    url = f"{USDA_BASE_URL}/reports/{slug_id}"
    resp = session.get(url, timeout=30)
    data = resp.json()

    results = data.get('results', [])
    print(f"Results: {len(results)} items")
    print(f"Report Sections: {data.get('reportSections', [])}")

    if results:
        # Get first record with narrative
        for r in results[:3]:
            narrative = r.get('report_narrative', '')
            if narrative:
                print(f"\nNarrative (first 400 chars):")
                print(narrative[:400])
                break
        else:
            print("\nNo narrative in first 3 records")
